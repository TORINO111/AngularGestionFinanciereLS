<!-- end page title -->
<app-page-title [breadcrumbItems]="pageTitle" title="Recettes"></app-page-title>
@if (!result) {
  <div class="loader-container">
    <div class="lds-dual-ring"></div>
  </div>
}
@if (result) {
  <div class="card">
    <div class="card-header etat">État des Recettes</div>
    <div class="card-body">
      @if (message) {
        <div class="alert alert-warning text-center animated fadeIn">
          {{ message }}
        </div>
      }
      <form [formGroup]="filtreForm" (ngSubmit)="chargerRecettes()">
        <div class="row g-2 mb-3 align-items-end"> <!-- align-items-end ici pour tout aligner proprement -->
          <!-- Filtres -->
          <div class="col-12 col-md-8">
            <div class="row g-2 align-items-end">
              <div class="col-6 col-md-3">
                <input type="date" formControlName="from" class="form-control" placeholder="De">
              </div>
              <div class="col-6 col-md-3">
                <input type="date" formControlName="to" class="form-control" placeholder="À">
              </div>
              <div class="col-12 col-md-4">
                <select name="codeJournal" formControlName="codeJournal" class="form-select" id="codeJournal">
                  <option [value]="null" disabled>---Select Journal---</option>
                  @for (cj of codesjournaux; track cj) {
                    <option [value]="cj.code">
                      {{ cj.libelle }}
                    </option>
                  }
                </select>
              </div>
              <div class="col-12 col-md-2 d-grid">
                <button class="btn btn-etat w-100" type="submit">
                  <i class="fa fa-search me-1"></i> Charger
                </button>
              </div>
            </div>
          </div>
          <!-- Boutons Export -->
          <div class="col-12 col-md-4">
            <div class="row g-2 align-items-end">
              <div class="col-6 d-grid">
                <button (click)="exporterExcel()" class="btn btn-etat w-100">
                  <i class="fa fa-file-excel-o me-1"></i> Excel
                </button>
              </div>
              <div class="col-6 d-grid">
                <button (click)="exporterPDF()" class="btn btn-etat w-100">
                  <i class="fa fa-file-pdf-o me-1"></i> PDF
                </button>
              </div>
            </div>
            @if (enCours) {
              <div class="progress-container">
                <div class="progress-bar" [style.width.%]="progression"></div>
              </div>
            }
          </div>
        </div>
      </form>
      <div class="table-container">
        <table class="table table-bordered table-hover">
          <thead class="table-light">
            <tr>
              <th>Date</th>
              <th>Montant</th>
              <th>Nature Opération</th>
              <th>Tiers</th>
              <th>Journal</th>
            </tr>
          </thead>
          @if (!loading) {
            <tbody>
              @for (r of recettes; track r) {
                <tr>
                  <td>{{ r.dateOperation | date }}</td>
                  <td>{{ r.montant | number:'1.2-2' }}</td>
                  <td>{{ r.libelleNature }}</td>
                  <td>{{ r.tiersNom }}</td>
                  <td>{{ r.codeJournal }}</td>
                </tr>
              }
              @if (recettes.length == 0 ) {
                <tr>
                  <td  colspan="5"><h3 style="text-align: center;">Aucune recette trouvée</h3></td>
                </tr>
              }
            </tbody>
          }
          @if (loading) {
            <tbody>
              <tr>
                <td colspan="5" class="text-center">
                  <div class="spinner-border text-secondary" role="status">
                    <span class="visually-hidden">Chargement...</span>
                  </div>
                </td>
              </tr>
            </tbody>
          }
        </table>
      </div>
    </div>
  </div>
}
