<!-- end page title -->
<app-page-title [breadcrumbItems]="pageTitle" title="Les sociétés"></app-page-title>

<div class="loader-container" *ngIf="!result">
  <div class="lds-dual-ring"></div>
</div>
<!-- start page title -->
<div class="mt-2 card" *ngIf="result">
  <div class="card-body">

    <form [formGroup]="societeForm">
      <!-- Toolbar responsive -->
      <div class="toolbar d-flex flex-wrap gap-2 mb-3">
        <button type="button" class="btn btn-success" (click)="ajouter()">Nouveau</button>
        <button type="button" class="btn btn-success" (click)="modifier()" [disabled]="selectedIndex === null">Modifier</button>
        <button type="button" class="btn btn-danger" (click)="supprimer()" [disabled]="selectedIndex === null">Supprimer</button>
        <button type="button" class="btn btn-success" (click)="enregistrer()" [disabled]="!formVisible">Enregistrer</button>
        <button type="button" class="btn btn-success" (click)="fermer()" [disabled]="!formVisible">Fermer</button>
      </div>
    
    
      <div class="container-fluid">
        <!-- Formulaire principal -->
        <div class="row mb-3" *ngIf="formVisible">
          <div class="row" >
          <div class="col-12 col-md-2 mb-2">
            <div class="form-group">
              <label for="">Nom</label>
            <input type="text" id="nom" name="nom" formControlName="nom" class="form-control" placeholder="Nom">
            <strong class="text-danger" *ngIf="societeForm.get('nom').hasError('required') && societeForm.get('nom').touched">
              Champ obligatoire !
            </strong>
            </div>
          </div>
          <div class="col-12 col-md-2 mb-2">
            <div class="form-group">
              <label for="">Adresse</label>
            <input type="text" id="adresse" name="adresse" formControlName="adresse" class="form-control" placeholder="Adresse">
            <strong class="text-danger" *ngIf="societeForm.get('adresse').hasError('required') && societeForm.get('adresse').touched">
              Champ obligatoire !
            </strong>
            </div>
          </div>
          <div class="col-12 col-md-2 mb-2">
            <div class="form-group">
              <label for="">Telephone</label>
            <input type="text" id="nom" name="telephone" formControlName="telephone" class="form-control" placeholder="Telephone">
            <strong class="text-danger" *ngIf="societeForm.get('telephone').hasError('required') && societeForm.get('telephone').touched">
              Champ obligatoire !
            </strong>
            </div>
          </div>
          <div class="col-12 col-md-2 mb-2">
            <div class="form-group">
              <label for="">Email</label>
            <input type="text" id="email" name="email" formControlName="email" class="form-control" placeholder="Email">
            <strong class="text-danger" *ngIf="societeForm.get('email').hasError('required') && societeForm.get('email').touched">
              Champ obligatoire !
            </strong>
            </div>
          </div>
          <div class="col-12 col-md-2 mb-2">
            <div class="form-group">
              <label for="">IFU</label>
            <input type="text" id="numeroIFU" name="numeroIFU" formControlName="numeroIFU" class="form-control" placeholder="IFU">
            <strong class="text-danger" *ngIf="societeForm.get('numeroIFU').hasError('required') && societeForm.get('numeroIFU').touched">
              Champ obligatoire !
            </strong>
            </div>
          </div>
      
          <div class="col-12 col-md-4 mb-2">
            <div class="form-group">
              <label for="">Pays</label>
              <select required name="paysId"
              formControlName="paysId"
              class="form-select"
              id="paysId">
                <option [value]="null" disabled>---Select Pays---</option>
                <option *ngFor="let p of pays" [value]="p.id">
                {{ p.libelle }}
                </option>
            </select>
            <strong class="text-danger" *ngIf="societeForm.get('paysId').hasError('required') && societeForm.get('paysId').touched">
              Champ obligatoire !
            </strong>
            </div>
        </div>

        <div class="col-12 col-md-4 mb-2">
          <div class="form-group">
            <label for="">Comptable</label>
            <select required name="comptableId"
            formControlName="comptableId"
            class="form-select"
            id="comptableId">
              <option [value]="null" disabled>---Select Comptable---</option>
              <option *ngFor="let comptable of comptables" [value]="comptable.id">
              {{ comptable.prenom +" "+ comptable.nom}}
              </option>
          </select>
          <strong class="text-danger" *ngIf="societeForm.get('comptableId').hasError('required') && societeForm.get('comptableId').touched">
            Champ obligatoire !
          </strong>
          </div>
      </div>

          
        </div>
        
         </div>
      </div>
      
    </form>

      <div class="table-container">
        <table class="table table-bordered table-sm custom-table">
      <thead>
        <tr>
          <th>Nom</th>
          <th>Adresse</th>
          <th>Telephone</th>
          <th>Email</th>
          <th>IFU</th>
          <th>Pays</th>
          <th>Comptable</th>
        </tr>
      </thead>
      <tbody *ngIf="!isLoading">
        <tr  *ngFor="let societe of societes; let i = index"
        (click)="selectLigne(i)"
        [class.selected]="i === selectedIndex">
          <td>{{ societe.value.nom }}</td>
          <td>{{ societe.value.adresse }}</td>
          <td>{{ societe.value.telephone }}</td>
          <td>{{ societe.value.email }}</td>
          <td>{{ societe.value.numeroIFU }}</td>
          <td>{{ societe.value.paysNom }}</td>
          <td>{{ societe.value.comptableNom }}</td>
          
        </tr>
        <tr *ngIf="societes?.length == 0" >
            <td  colspan="7"><h3 style="text-align: center;">Aucune donnée trouvée</h3></td>
          </tr>
      </tbody>
      <tbody *ngIf="isLoading">
        <tr>
          <td colspan="7" class="text-center">
            <div class="spinner-border text-secondary" role="status">
              <span class="visually-hidden">Chargement...</span>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
    </div>
 
    </div>
  </div>
