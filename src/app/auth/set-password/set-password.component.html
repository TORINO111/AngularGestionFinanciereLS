<app-default-layout>
  <div class="auth-logo mx-auto">
    <a [routerLink]="['']" class="logo logo-dark text-center">
      <span class="logo-lg">
        <img src="assets/images/logo-sm.png" alt="" height="44">
      </span>
    </a>
    <a [routerLink]="['']" class="logo logo-light text-center">
      <span class="logo-lg">
        <img src="assets/images/logo-light.png" alt="" height="24">
      </span>
    </a>
  </div>
  <h6 class="h5 mb-0 mt-3" i18n>Initialisation du compte superviseur</h6>
  <!-- <p class="text-muted mt-1 mb-4" i18n>
    Société :
  </p> -->

  <form name="set-password-form" [formGroup]="passwordForm" (ngSubmit)="onSubmit()" class="authentication-form">
    @if (successMessage) {
    <ngb-alert type="success" [dismissible]="false">{{ successMessage }}</ngb-alert>
    }
    @if (errorMessage) {
    <ngb-alert type="danger" [dismissible]="false">{{ errorMessage }}</ngb-alert>
    }

    <div class="mb-3">
      <div class="mb-3">
        <label class="form-label" i18n>Jeton d'activation</label>
        <input type="text" class="form-control" formControlName="token" required>
      </div>

      <label class="form-label">Civilité</label>
      <select class="form-control" formControlName="civilite">
        <option value="" disabled selected>Choisir une option</option>
        <option value="HOMME">Homme</option>
        <option value="FEMME">Femme</option>
      </select>
    </div>

    <div class="mb-3">
      <label class="form-label" i18n>Prénom</label>
      <input type="text" class="form-control" formControlName="prenom" required
        [ngClass]="{'is-invalid': passwordForm.get('prenom')?.touched && passwordForm.get('prenom')?.invalid}">
      @if (passwordForm.get('prenom')?.touched && passwordForm.get('prenom')?.invalid) {
      <div class="invalid-feedback d-block">
        @if (passwordForm.get('prenom')?.errors?.required) {
        <div i18n>Le prénom est obligatoire.</div>
        }
        @if (passwordForm.get('prenom')?.errors?.containsDigits) {
        <div i18n>Le prénom ne peut pas contenir de chiffres.</div>
        }
        @if (passwordForm.get('prenom')?.errors?.lettersAndAccents) {
        <div i18n>Le prénom ne doit contenir que des lettres, des accents ou des tirets.</div>
        }
      </div>
      }
    </div>

    <div class="mb-3">
      <label class="form-label" i18n>Nom</label>
      <input type="text" class="form-control" formControlName="nom" required
        [ngClass]="{'is-invalid': passwordForm.get('nom')?.touched && passwordForm.get('nom')?.invalid}">
      @if (passwordForm.get('nom')?.touched && passwordForm.get('nom')?.invalid) {
      <div class="invalid-feedback d-block">
        @if (passwordForm.get('nom')?.errors?.required) {
        <div i18n>Le nom est obligatoire.</div>
        }
        @if (passwordForm.get('nom')?.errors?.containsDigits) {
        <div i18n>Le nom ne peut pas contenir de chiffres.</div>
        }
        @if (passwordForm.get('nom')?.errors?.lettersAndAccents) {
        <div i18n>Le nom ne doit contenir que des lettres, des accents ou des tirets.</div>
        }
      </div>
      }
    </div>

    <div class="mb-3">
      <label class="form-label" i18n>Nom d'utilisateur</label>
      <input type="text" class="form-control" formControlName="username" required
        [ngClass]="{'is-invalid': passwordForm.get('username')?.touched && passwordForm.get('username')?.invalid}">
      @if (passwordForm.get('username')?.touched && passwordForm.get('username')?.invalid) {
      <div class="invalid-feedback d-block">
        @if (passwordForm.get('username')?.errors?.required) {
        <div i18n>Le nom d'utilisateur est obligatoire.</div>
        }
        @if (passwordForm.get('username')?.errors?.lettersOnly) {
        <div i18n>Le nom d'utilisateur ne doit contenir que des lettres.</div>
        }
        @if (passwordForm.get('username')?.errors?.backendError) {
        <div i18n>{{ passwordForm.get('username')?.errors?.backendError }}</div>
        }
      </div>
      }
    </div>

    <div class="mb-3">
      <label class="form-label" i18n>Email</label>
      <input type="email" class="form-control" formControlName="email" required
        [ngClass]="{'is-invalid': passwordForm.get('email')?.touched && passwordForm.get('email')?.invalid}">
      @if (passwordForm.get('email')?.touched && passwordForm.get('email')?.invalid) {
      <div class="invalid-feedback d-block">
        @if (passwordForm.get('email')?.errors?.required) {
        <div i18n>L'email est obligatoire.</div>
        }
        @if (passwordForm.get('email')?.errors?.email) {
        <div i18n>Veuillez entrer une adresse email valide.</div>
        }
      </div>
      }
    </div>

    <div class="mb-3">
      <label class="form-label" i18n>Téléphone</label>
      <input type="tel" class="form-control" formControlName="telephone" required
        [ngClass]="{'is-invalid': passwordForm.get('telephone')?.touched && passwordForm.get('telephone')?.invalid}">
      @if (passwordForm.get('telephone')?.touched && passwordForm.get('telephone')?.invalid) {
      <div class="invalid-feedback d-block">
        @if (passwordForm.get('telephone')?.errors?.required) {
        <div i18n>Le téléphone est obligatoire.</div>
        }
        @if (passwordForm.get('telephone')?.errors?.pattern) {
        <div i18n>Veuillez entrer un numéro de téléphone valide.</div>
        }
        @if (passwordForm.get('telephone')?.errors?.backendError) {
        <div i18n>{{ passwordForm.get('telephone')?.errors?.backendError }}</div>
        }
      </div>
      }
    </div>

    <div class="mb-3">
      <label class="form-label" i18n>Nouveau mot de passe</label>
      <div class="input-group">
        <span class="input-group-text">
          <i class="icon-dual" data-feather="lock" appFeatherIcon></i>
        </span>
        <input type="password" class="form-control" formControlName="newPassword"
          [ngClass]="{'is-invalid': passwordForm.get('newPassword')?.touched && passwordForm.get('newPassword')?.invalid}"
          required>
      </div>
      @if (passwordForm.get('newPassword')?.touched && passwordForm.get('newPassword')?.invalid) {
      <div class="invalid-feedback d-block">
        @if (passwordForm.get('newPassword')?.errors?.required) {
        <div i18n>Nouveau mot de passe est obligatoire.</div>
        }
        @if (passwordForm.get('newPassword')?.errors?.minlength) {
        <div i18n>Le mot de passe doit avoir au moins 8 caractères.</div>
        }
      </div>
      }
    </div>

    <div class="mb-3">
      <label class="form-label" i18n>Confirmer le mot de passe</label>
      <div class="input-group">
        <span class="input-group-text">
          <i class="icon-dual" data-feather="lock" appFeatherIcon></i>
        </span>
        <input type="password" class="form-control" formControlName="confirmPassword"
          [ngClass]="{'is-invalid': passwordForm.get('confirmPassword')?.touched && passwordForm.errors?.['mismatch']}"
          required>
      </div>
      @if (passwordForm.get('confirmPassword')?.touched && passwordForm.errors?.['mismatch']) {
      <div class="invalid-feedback d-block" i18n>
        Les mots de passe ne correspondent pas.
      </div>
      }
    </div>

    <div class="mb-3 text-center d-grid">
      <button class="btn btn-primary" type="submit" [disabled]="passwordForm.invalid" i18n>Enregistrer</button>
    </div>
  </form>
</app-default-layout>